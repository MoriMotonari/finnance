{% import "main/trans_modal.j2" as trans_modal %}

{% macro trans_table_head() %}
    <col style="width:auto">
    <col style="width:auto">
    <col style="width:20%">
    <col style="width:auto">
    <col style="width:auto">
    <col style="width:auto">
    <col style="width:30%">
    <thead>
        <tr>
            <th scope="col">Date</th>
            <th scope="col">Time</th>
            <th scope="col">To / From</th>
            <th style="text-align: right;" scope="col">Amount</th>
            <th style="text-align: right;" scope="col">Saldo</th>
            <th scope="col">Category</th>
            <th scope="col">Comment</th>
            <th scope="col"></th>
        </tr>
    </thead>
{% endmacro %}

{% macro trans_table_forloop(changes, redirect_url, account, agents, categories) %}
{% for change in changes %}
    <tr>
        <td data-sort="{{ change.date_issued.strftime('%Y%m%d%H%M%s') }}">
            {{ change.date_issued.strftime('%d.%m.%Y') }}
        </td>
        <td>{{ change.date_issued.strftime('%H:%M') }}</td>
        <td>{% if change.transfer %}<a href="{{ url_for('main.account', account_id=change.agent_id) }}">{{ change.agent }}</a>{% else %}{{ change.agent }}{% endif %}</td>
        <td style="text-align: right;"  
            data-sort="{% if change.is_expense %}{{ change.amount }}{% else %}{{ -change.amount }}{% endif %}"
            {% if change.is_expense %}
                class="text-danger"
            {% else %}
                class="text-success"
            {% endif %}>
            {{ change.amount }} {{ account.currency.code }}
        </td>
        <td style="text-align: right;"  
            data-sort="{{ saldo }}">
            {{ change.saldo() }} {{ account.currency.code }}
        </td>
        <td><span class="rounded p-1 {% if change.transfer or change.direct_flow_in is not none %}bg-info{% endif %}">{{ change.category }}</span></td>
        <td>{{ change.comment }}</td>
        <td style="width: 44px; padding: 0px;">
            {% set id = "{acc}-{tr}".format(acc=account.id, tr=change.id) %}
            <button type="button" class="btn btn-warning btn-lg" style="height: 100%; width: 100%;"
              data-toggle="modal" data-target="{% if not change.transfer %}#transModal{% else %}#transferModal{% endif %}{{ id }}" >
                <i class="fa fa-pencil"></i>
            </button>
            <!-- Modal -->
            <!-- defined in included trans_modals.j2 -->
            {% if not change.transfer %}{{ trans_modal.modal(account, redirect_url, agents, categories, change) }}{% endif %}
        </td>
    </tr>
{% endfor %}
{% endmacro %}